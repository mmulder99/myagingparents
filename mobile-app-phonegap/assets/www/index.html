<!DOCTYPE HTML>
<html>
  <head>
   <title>Cordova</title>
  <style type="text/css">
    img {
      width: 100%;
    }
    
    body {
      
    }
    .header {
      width: 100%;
    }
    
    .branding {
      min-width: 300px;
      max-width: 500px;
      float: right;
    } 
    .company-name {
      text-indent: -9999px;
      height: 0;
      font-size: 0;
      line-height: 0;
    }
    .email-sign-up {
      float: right;
    }
    
    .main {
      clear: both;
      width: 100%;
    }
    
    .main-left {
      min-width: 300px;
      max-width: 500px;
      float: left;
      padding:20px;
    }
    
    .main-right {
      min-width: 300px;
      max-width: 500px;
      float: left;
      padding:20px;
    }
    
    .footer {
      
    }

    #statusUpdate a {
        display: block;
        height: 300px;
        width: 300px;
        float: left;
        margin: 20px;
    }
   </style>
   <script type="text/javascript" charset="utf-8" src="jquery-1.10.1.min.js"></script>
   <script type="text/javascript" charset="utf-8" src="cordova-2.5.0.js"></script>
   <script type="text/javascript" charset="utf-8">

	var phoneNumber;
	
    document.addEventListener("deviceready", onDeviceReady, false);

    function onDeviceReady() {
        phoneNumber = window.localStorage.getItem("phoneNumber");
        
        if (phoneNumber === null) {
        	console.log("Account not found.");
        	hideButtons();
        }
        else {
        	console.log("Account found for phone number: " + phoneNumber);
			showButtons();        	
        }
    }
    
    function hideButtons() {
       	$("#login").css("visibility", "visible");
       	$("#statusUpdate").css("visibility", "hidden");
    }
    
    function showButtons() {
    	$("#login").css("visibility", "hidden");
        $("#statusUpdate").css("visibility", "visible");
    }
    
    function login() {
    	var providedPhoneNumber = $("#phoneNumber").val();
    	console.log("Logging in with phone number: " + providedPhoneNumber);
    	
    	if (providedPhoneNumber === null) {
    	    alert("Please enter a valid Family Phone Number.");
    	}
    	else {
    	    phoneNumber = providedPhoneNumber;
    	    showButtons();
    	    console.log("Logged in with phone number: " + phoneNumber);
    	}
    }
    
    function sendNotification(message) {
    	$.ajax({
		type: "GET",
    		url: "http://54.214.232.23:3000/accounts/send_message", 
  		data: { phone: phoneNumber, message: message },
  		dataType: 'html',
    		success: function (response) {
        		alert("Message sent!");
      		},
    		error: function (xhr, ajaxOptions, thrownError) {
        		alert("Error sending message: " + thrownError);
      		}
		});
    } 
    </script>
  </head>
  <body>
  	<div id="login" style="visibility: visible;">
  		<form action="#">
  			<label for="phoneNumber">Family Phone Number</label>
  			<input id="phoneNumber" type="text" value="6043155762"/>
  			<a id="goButton" onClick="login();">Go!</a>
  		</form>
  	</div>
  	<div id="statusUpdate" style="visibility: hidden;">
		<a id="pillsButton" onClick="sendNotification('Mom took her pills.');"><img src='images/Pill.png'/></a>
		<a id="walkButton" onClick="sendNotification('Mom took a walk and returned.');"><img src='images/Walk.png'/></a>
		<a id="mealButton" onClick="sendNotification('Mom ate her meal.');"><img src='images/Eat.png'/></a>
		<a id="wellnessButton" onClick="sendNotification('Mom is well.');"><img src='images/AmOK.png'/></a>
  	</div>
  </body>
</html>
